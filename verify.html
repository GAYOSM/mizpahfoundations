<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Certificate Verification</title>

<style>

body{
font-family: Arial;
background:#f4f6f8;
padding:40px;
}

.container{
background:white;
padding:20px;
border-radius:10px;
max-width:500px;
margin:auto;
box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

input{
padding:10px;
width:70%;
margin-right:10px;
}

button{
padding:10px 15px;
background:#2563eb;
color:white;
border:none;
cursor:pointer;
}

img{
margin-top:10px;
}

</style>

</head>
<body>

<div class="container">

<h2>Certificate Verification</h2>

<input id="reg" placeholder="Enter Register Number">

<button id="verifyBtn">Verify</button>

<div id="result" style="margin-top:20px;"></div>

</div>


<script type="module">

import { db } from './js/firebase-config.js';

import {
doc,
getDoc
}
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";


const regInput = document.getElementById("reg");

const result = document.getElementById("result");

const verifyBtn = document.getElementById("verifyBtn");


// ✅ Main Verify Function
async function verifyStudent(regNum){

if(!regNum){

result.innerHTML="<span style='color:red'>Enter Register Number</span>";

return;

}

try{

const ref = doc(db,"students",regNum);

const snap = await getDoc(ref);

if(snap.exists()){

const s = snap.data();

result.innerHTML = `

<h3 style="color:green;">Verified ✅</h3>

<img src="${s.imageUrl || 'https://via.placeholder.com/120'}"
width="120"
style="border-radius:50%;object-fit:cover;">

<p><b>Name:</b> ${s.name}</p>

<p><b>Register Number:</b> ${regNum}</p>

<p><b>Position:</b> ${s.position || '-'}</p>

<p><b>Email:</b> ${s.email || '-'}</p>

`;

}else{

result.innerHTML="<h3 style='color:red'>❌ Certificate Not Found</h3>";

}

}catch(error){

result.innerHTML="<span style='color:red'>Error loading data</span>";

console.error(error);

}

}


// ✅ Button Click Event
verifyBtn.onclick=function(){

verifyStudent(regInput.value.trim());

}


// ✅ AUTO VERIFY FROM QR LINK
const params = new URLSearchParams(window.location.search);

const regFromURL = params.get("reg");

if(regFromURL){

regInput.value = regFromURL;

verifyStudent(regFromURL);

}

</script>

</body>
</html>