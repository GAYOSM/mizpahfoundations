<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Admin Dashboard - Mizpah Foundations</title>

<style>

body{
font-family: Arial;
background:#f4f6f8;
margin:0;
}

header{
background:#0a2a66;
color:white;
padding:15px;
display:flex;
justify-content:space-between;
align-items:center;
}

.container{
padding:20px;
max-width:800px;
margin:auto;
}

input, textarea{
width:100%;
padding:10px;
margin-top:10px;
border:1px solid #ccc;
border-radius:4px;
}

button{
padding:10px 15px;
margin-top:10px;
background:#0a2a66;
color:white;
border:none;
cursor:pointer;
border-radius:4px;
}

button:hover{
background:#081f4d;
}

.news-card{
background:white;
padding:15px;
margin-top:15px;
border-radius:6px;
box-shadow:0 2px 5px rgba(0,0,0,0.1);
}

.delete-btn{
background:#c62828;
margin-top:10px;
}

.delete-btn:hover{
background:#8e0000;
}

#status{
margin-top:10px;
font-weight:bold;
color:green;
}

</style>

</head>
<body>

<header>

<h2>Admin Dashboard</h2>

<button onclick="logout()">Logout</button>

</header>


<div class="container">

<h3>Publish News</h3>

<input type="text" id="title" placeholder="Enter news title">

<textarea id="content" placeholder="Enter news content"></textarea>

<button onclick="addNews()">Publish News</button>

<div id="status"></div>


<h3>All Published News</h3>

<div id="newsList"></div>

</div>



<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

<script src="/js/firebase-config.js"></script>

<script src="../js/admin.js"></script>


<script>

const auth = firebase.auth();
const db = firebase.firestore();


// Protect dashboard
auth.onAuthStateChanged(user => {

if(!user){

window.location="/login.html";
return;

}

if(user.email !== "mizpahfoundations123@gmail.com"){

alert("Access denied");
window.location="/index.html";

}

});




// Logout
function logout(){

auth.signOut().then(()=>{
window.location="/login.html";
});

}



// Add News
function addNews(){

const title=document.getElementById("title").value.trim();
const content=document.getElementById("content").value.trim();

if(title==="" || content===""){

alert("Enter title and content");
return;

}


db.collection("news").add({

title:title,
content:content,
createdAt:firebase.firestore.FieldValue.serverTimestamp()

})
.then(()=>{

document.getElementById("status").innerHTML="âœ… News published successfully";

document.getElementById("title").value="";
document.getElementById("content").value="";

loadNews();

})
.catch(error=>{

alert(error.message);

});

}




// Load News
function loadNews(){

db.collection("news")
.orderBy("createdAt","desc")
.onSnapshot(snapshot=>{

const newsList=document.getElementById("newsList");

newsList.innerHTML="";

snapshot.forEach(doc=>{

const data=doc.data();

newsList.innerHTML+=`

<div class="news-card">

<h4>${data.title}</h4>

<p>${data.content}</p>

<button class="delete-btn" onclick="deleteNews('${doc.id}')">
Delete
</button>

</div>

`;

});

});

}




// Delete News
function deleteNews(id){

if(confirm("Delete this news?")){

db.collection("news").doc(id).delete();

}

}




// Load news on start
loadNews();


</script>


</body>
</html>